<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TDK - Akdeniz Operasyonel Harita</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body, html { margin: 0; padding: 0; height: 100%; background: #000814; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        #map { height: 100vh; width: 100%; background: #000814; }
        
        /* Neon Kontrol Paneli */
        #control-panel {
            position: absolute; bottom: 30px; left: 20px; z-index: 1000;
            background: rgba(0, 12, 24, 0.9); padding: 20px; border-radius: 12px;
            border: 2px solid #00f2ff; color: white; width: 260px;
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.4);
        }

        #logo-container {
            position: absolute; top: 20px; right: 20px; z-index: 1000;
            background: rgba(255, 255, 255, 0.95); padding: 10px; border-radius: 8px;
            border: 2px solid #004080;
        }

        .navy-logo { width: 100px; display: block; filter: drop-shadow(0 0 5px rgba(0,0,0,0.2)); }
        .slider { width: 100%; cursor: pointer; accent-color: #00f2ff; margin-top: 10px; }
        .title { font-size: 13px; font-weight: bold; text-transform: uppercase; letter-spacing: 1.5px; color: #00f2ff; text-shadow: 0 0 5px #00f2ff; }
    </style>
</head>
<body>

<div id="logo-container">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/12/Turkish_Naval_Forces_Command_Logo.svg/1200px-Turkish_Naval_Forces_Command_Logo.svg.png" class="navy-logo">
</div>

<div id="control-panel">
    <div class="title">BAYRAK SAYDAMLIK SEVİYESİ</div>
    <input type="range" id="opacitySlider" min="0" max="100" value="80" class="slider">
    <div id="opacityVal" style="text-align:right; margin-top:5px; font-family: monospace; color: #00f2ff;">%80</div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const map = L.map('map', { center: [35, 25], zoom: 5, zoomControl: false });

    // Karanlık deniz haritası tabanı
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

    // Kapsamlı Akdeniz Ülkeleri Listesi (ID eşleşmesi için çoklu isimler)
    const mediterraneanCountries = {
        "Turkey": "tr", "Türkiye": "tr", "Northern Cyprus": "tr", "Cyprus": "cy",
        "Greece": "gr", "Italy": "it", "Spain": "es", "France": "fr",
        "Egypt": "eg", "Libya": "ly", "Tunisia": "tn", "Algeria": "dz",
        "Morocco": "ma", "Syria": "sy", "Lebanon": "lb", "Israel": "il",
        "Palestine": "ps", "Albania": "al", "Croatia": "hr", "Montenegro": "me",
        "Slovenia": "si", "Malta": "mt"
    };

    // SVG Pattern tanımları için güvenli bir yöntem
    const svg = L.SVG.create('svg');
    const defs = L.SVG.create('defs');
    svg.appendChild(defs);
    document.body.appendChild(svg);

    function createPattern(countryName, flagCode) {
        const id = "flag-" + countryName.replace(/\s+/g, '-');
        if (document.getElementById(id)) return id;

        const pattern = L.SVG.create('pattern');
        pattern.setAttribute('id', id);
        pattern.setAttribute('patternUnits', 'objectBoundingBox');
        pattern.setAttribute('width', '1');
        pattern.setAttribute('height', '1');

        const img = L.SVG.create('image');
        img.setAttribute('href', `https://flagcdn.com/w640/${flagCode}.png`);
        img.setAttribute('width', '100%');
        img.setAttribute('height', '100%');
        img.setAttribute('preserveAspectRatio', 'none');
        
        pattern.appendChild(img);
        defs.appendChild(pattern);
        return id;
    }

    let geojsonLayer;

    // Harita verisini çek ve uygula
    fetch('https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson')
    .then(r => r.json())
    .then(data => {
        geojsonLayer = L.geoJson(data, {
            filter: f => mediterraneanCountries[f.properties.ADMIN] || mediterraneanCountries[f.properties.NAME],
            style: f => {
                const name = f.properties.ADMIN || f.properties.NAME;
                const flagCode = mediterraneanCountries[name];
                const patternId = createPattern(name, flagCode);
                
                return {
                    fillColor: `url(#${patternId})`,
                    fillOpacity: 0.8,
                    color: '#00f2ff', // Parlak turkuaz sınırlar
                    weight: 2,
                    opacity: 1
                };
            },
            onEachFeature: (f, l) => {
                l.bindPopup(`<b>${f.properties.ADMIN}</b>`);
                // Görsel interaktivite
                l.on('mouseover', function() {
                    this.setStyle({ weight: 4, color: '#fff', fillOpacity: 1 });
                });
                l.on('mouseout', function() {
                    geojsonLayer.resetStyle(this);
                });
            }
        }).addTo(map);
    });

    // Slider Fonksiyonu
    const slider = document.getElementById('opacitySlider');
    slider.oninput = function() {
        const val = this.value / 100;
        document.getElementById('opacityVal').innerText = '%' + this.value;
        if(geojsonLayer) {
            geojsonLayer.eachLayer(layer => {
                layer.setStyle({ fillOpacity: val });
            });
        }
    };
</script>
</body>
</html>
